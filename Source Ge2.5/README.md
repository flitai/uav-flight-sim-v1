


# 小型固定翼无人机飞行动力学与飞行控制仿真

本项目是一个基于C++的小型固定翼无人机飞行动力学与飞行控制仿真平台。它旨在为无人机研究和开发提供一个模块化、可扩展且较为逼真的仿真环境，替代简单的PID+运动学模型。

## ✨ 项目特性

* **六自由度 (6-DOF) 动力学模型**:
    * 包含平动和转动动力学方程。
    * 考虑空气动力（升力、阻力、侧力）、重力和推力。
    * 气动力矩计算。
* **串级PID控制架构**:
    * **外环 (航迹/航路跟随)**: 控制航向、高度、空速，输出期望姿态和油门指令。
    * **中环 (姿态/速率生成)**: 控制姿态角，输出期望角速率指令。
    * **内环 (角速率控制)**: 控制机体角速率，输出舵面偏转指令。
    * 各环路执行频率可配置 (典型值：外环20Hz，中环50Hz，内环100Hz)。
* **模块化设计**:
    * 代码结构清晰，分为动力学、控制、配置、通用类型等模块。
    * 易于扩展，例如更换气动数据库或添加新的控制算法。
* **参数可配置**:
    * 无人机物理参数（质量、惯量等）、气动系数、PID增益等均在 `Config.hpp` 中集中定义，方便调整。
* **数值积分**:
    * 采用四阶龙格-库塔法 (RK4)进行状态积分，保证数值稳定性和精度。
* **数据记录**:
    * 仿真过程中的关键状态量和控制指令可记录到CSV文件 (`simulation_log.csv`)，便于后续分析和可视化。
* **接口兼容性**:
    * 设计时考虑了保留现有接口文档中的输入/输出字段，以实现向后兼容。

## 🎯 系统需求 (设计目标)

* **实时性**: 仿真步长不大于 0.01秒，支持6-DOF状态更新与控制运算。
* **精度**: 考虑升力、阻力、侧力及机动特性，航向/姿态/速度跟踪误差不大于5%。
* **可扩展性**: 支持载荷变化、风场扰动、不同气动数据库切换。

## 🛠️ 项目模块说明

1.  **`CommonTypes.hpp`**:
    * 定义了仿真中使用的核心数据结构，如 `UAVState` (无人机状态)、`ControlInputs` (控制输入)、`FlightPathCommand` (飞行路径指令) 等。

2.  **`Config.hpp`**:
    * 包含了所有的仿真配置参数，如物理常数、无人机参数（质量、惯量、参考尺寸）、气动系数（来自文档表3.3）、PID控制器增益（来自文档第4节）、舵面限制和仿真步长等。

3.  **`PIDController.hpp / .cpp`**:
    * 实现了一个通用的PID控制器类，支持P, PI, PD, PID控制模式。
    * 包含积分抗饱和和输出限幅功能。

4.  **`DynamicsModel.hpp / .cpp`**:
    * 实现了 `IDynamicsModel` 接口和 `SixDOFModel` 类。
    * `SixDOFModel` 包含了无人机的六自由度动力学方程（平动和转动）。
    * 根据当前状态和控制输入计算气动力、重力、推力及其产生的力矩。
    * 使用RK4数值积分方法更新无人机状态。

5.  **`ControlSystem.hpp / .cpp`**:
    * 实现了三级串级PID控制器：`OuterLoopController` (外环)、`MiddleLoopController` (中环) 和 `InnerLoopController` (内环)。
    * `CascadedController` 类负责协调这三个环路的执行，并根据预设的频率（如外环20Hz，中环50Hz，内环100Hz）进行调度。

6.  **`SimulationEngine.hpp / .cpp`**:
    * 仿真引擎，负责驱动整个仿真流程。
    * 管理仿真时间，按预定步长调用控制器和动力学模型进行更新。

7.  **`main.cpp`**:
    * 主程序入口，演示了如何初始化仿真引擎、设置初始条件和目标、运行仿真循环，并记录数据。

## ⚙️ 依赖项

* C++ 编译器 (支持 C++17，例如 GCC, Clang, MSVC)
* Eigen 3 库 (用于矩阵和向量运算)

## 🚀 编译与运行

### 编译

1.  确保已安装 Eigen 3 库，并知道其头文件路径。
2.  使用C++编译器编译所有 `.cpp` 文件。例如，使用 g++：

```bash
g++ -std=c++17 main.cpp PIDController.cpp DynamicsModel.cpp ControlSystem.cpp SimulationEngine.cpp -I /path/to/your/eigen/library -o uav_sim
```

将 `/path/to/your/eigen/library` 替换为你系统中 Eigen 库的实际路径。

### 运行

编译成功后，会生成一个名为 `uav_sim` (或你指定的名字) 的可执行文件。运行：

```bash
./uav_sim
```


## 🔧 参数配置

大部分仿真参数，包括无人机特性、气动系数和PID增益，都可以在 `Config.hpp` 文件中进行修改。根据您的具体无人机型号和控制需求调整这些参数以获得最佳仿真效果。

## 📊 输出

仿真程序会在运行时将关键数据输出到控制台，并生成一个名为 `simulation_log.csv` 的文件。该CSV文件包含了详细的仿真数据，如时间、位置、速度、姿态、角速率、控制指令等，可用于绘图和分析。

## 📄 参考

本项目的设计主要基于以下文档中描述的飞行动力学模型和级联控制架构：
* 小型固定翼无人机飞行动力学与飞行控制仿真设计

